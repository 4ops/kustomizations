name: Check Elastic Curator

on: [push]

jobs:
  check:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout SCM
      uses: actions/checkout@v1

    - name: Check dependencies
      env:
        BASEURL: https://storage.googleapis.com/kubernetes-release/release
      run: |
        if ! kubectl version --client --short &> /dev/null; then
          export RELEASE=$(curl -s "${BASEURL}/stable.txt")
          curl -LO "${BASEURL}/${RELEASE}/bin/linux/amd64/kubectl" || exit 42
          chmod +x ./kubectl
          mv ./kubectl /usr/local/bin/kubectl
        fi

        kubectl version --short --client

    - name: Try to kustomize
      run: |
        kubectl kustomize elastic/curator
